
# MediCoppia Tracker üíä

Un'applicazione PWA (Progressive Web App) professionale progettata per la gestione condivisa di terapie farmacologiche e integratori di coppia. Sviluppata con un approccio mobile-first, permette di tracciare le assunzioni giornaliere, gestire turni a giorni alterni e sincronizzare i dati in tempo reale tra dispositivi.

## ‚ú® Funzionalit√† Principali

*   **Multi-Utente Smart**:
    *   Profili per Paolo e Barbara con temi dedicati.
    *   **Login Automatico**: Rileva l'OS (Android -> Barbara, iOS -> Paolo) per un accesso immediato.
    *   **Setup Esclusivo**: Solo Paolo ha accesso al tab di configurazione avanzata per gestire i farmaci di tutta la famiglia.
*   **Gestione Turni Avanzata**:
    *   Supporto per frequenza giornaliera.
    *   Logica intelligente per "Giorni Alterni" (Turno A / Turno B) basata su epoca fissa.
*   **Farmacia Virtuale & Inventario üè•**:
    *   **Magazzino Centralizzato**: Tabella separata per i prodotti fisici.
    *   **Scorta Condivisa Reale**: Assunzioni diverse (es. Paolo Mattina e Barbara Sera) scalano dallo stesso prodotto in magazzino.
    *   **Rifornimento Rapido**: Pulsante `+` per aggiungere al volo una scatola alla scorta senza calcoli.
    *   **Supporto Liquidi e Unit√†**: Gestione di ml, gocce e bustine.
    *   **Correzione Manuale**: Strumenti per modificare le quantit√† attuali in caso di errori (Inventario).
    *   **Lista Spesa WhatsApp**: Generazione automatica lista mancanti da inviare al partner.
*   **Storico e Statistiche**: 
    *   Calendario mensile con indicatori di aderenza colorati.
*   **Sospensione Terapia ‚è∏Ô∏è**:
    *   Possibilit√† di archiviare i farmaci temporaneamente senza cancellarli.
*   **UX & Gamification**:
    *   Celebrazione con coriandoli al 100% completamento.
    *   Feedback visivi (pop/flash) e ordinamento cronologico intelligente (Mattina -> Sera).
*   **Funzionalit√† PWA**:
    *   Installabile su Home Screen (iOS/Android).
    *   Funziona come app nativa.
    *   Supporto Notifiche Push Locali per avvisi scorte.

## üõ†Ô∏è Stack Tecnologico

*   **Frontend**: React 19, TypeScript
*   **Stile**: Tailwind CSS
*   **Icone**: Lucide React
*   **Gestione Date**: date-fns
*   **Backend/Database**: Supabase
*   **Hosting**: Google Cloud Run (Container Docker)

## üóÑÔ∏è Configurazione Database (Supabase)

L'applicazione richiede le seguenti tabelle su Supabase. Esegui questo script nell'SQL Editor della tua dashboard Supabase:

```sql
-- 1. Tabella Magazzino (Farmacia Virtuale)
create table inventory (
  id uuid default gen_random_uuid() primary key,
  name text not null,
  quantity numeric default 0,
  threshold numeric default 5,
  pack_size numeric default 30, -- Nuovo in 1.22.x
  unit text default 'pz',       -- Nuovo in 1.22.x
  created_at timestamptz default now()
);

-- 2. Tabella Farmaci (Programmazione Assunzioni)
create table medications (
  id text primary key,
  user_id text not null,
  name text not null,
  dosage text,
  timing text,
  frequency text, -- 'daily', 'alternate_days', 'alternate_days_odd'
  notes text,
  icon text,      -- 'pill', 'drop', 'clock', 'sachet'
  stock_quantity numeric, -- (Legacy)
  stock_threshold numeric, -- (Legacy)
  is_archived boolean default false,
  shared_id text, -- (Legacy)
  product_id uuid references inventory(id), -- Link alla Farmacia Virtuale
  created_at timestamptz default now()
);

-- 3. Tabella Storico (Logs)
create table logs (
  id bigint generated by default as identity primary key,
  date text not null, -- Formato YYYY-MM-DD
  medication_id text not null references medications(id) on delete cascade,
  taken boolean default true,
  created_at timestamptz default now()
);

-- 4. Tabella Storico Rifornimenti
create table inventory_logs (
  id bigint generated by default as identity primary key,
  inventory_id uuid references inventory(id) on delete cascade,
  amount_added numeric not null,
  packs_added numeric not null,
  created_at timestamptz default now()
);

-- Abilita Realtime
alter publication supabase_realtime add table logs;
alter publication supabase_realtime add table medications;
alter publication supabase_realtime add table inventory;
alter publication supabase_realtime add table inventory_logs;

-- Policy di Sicurezza (Semplificata per uso personale)
alter table medications enable row level security;
alter table logs enable row level security;
alter table inventory enable row level security;
alter table inventory_logs enable row level security;
create policy "Accesso Totale" on medications for all using (true);
create policy "Accesso Totale" on logs for all using (true);
create policy "Accesso Totale" on inventory for all using (true);
create policy "Accesso Totale" on inventory_logs for all using (true);
```

**‚ö†Ô∏è Aggiornamento Versione 1.22.x**:
Se provieni da una versione precedente, √® necessario eseguire l'aggiornamento della tabella `inventory` (aggiunta colonne `pack_size`, `unit`) e la creazione di `inventory_logs`. Nell'app, andando in Impostazioni, un banner ti avviser√† se mancano le colonne e ti fornir√† l'SQL da copiare.

## üöÄ Installazione e Sviluppo Locale

1.  **Clona il repository**:
    ```bash
    git clone https://github.com/tuo-user/medicoppia.git
    cd medicoppia
    ```

2.  **Installa le dipendenze**:
    ```bash
    npm install
    ```

3.  **Avvia l'app**:
    ```bash
    npm start
    ```

## üê≥ Deploy con Docker (Cloud Run)

1.  **Build**:
    ```bash
    docker build -t medicoppia .
    ```

2.  **Run**:
    ```bash
    docker run -p 8080:8080 medicoppia
    ```
