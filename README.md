# MediCoppia Tracker üíä

Un'applicazione PWA (Progressive Web App) professionale progettata per la gestione condivisa di terapie farmacologiche e integratori di coppia. Sviluppata con un approccio mobile-first, permette di tracciare le assunzioni giornaliere, gestire turni a giorni alterni e sincronizzare i dati in tempo reale tra dispositivi.

## ‚ú® Funzionalit√† Principali

*   **Multi-Utente**: Profili distinti per Paolo e Barbara con temi visivi dedicati (Blu e Rosa).
*   **Smart Login üß†**: Rileva automaticamente il sistema operativo per selezionare l'utente:
    *   **Android** ‚Üí Barbara
    *   **iOS (iPhone/iPad)** ‚Üí Paolo
*   **Sincronizzazione Cloud**: Database Supabase per dati in tempo reale su tutti i dispositivi.
*   **Gestione Turni Avanzata**:
    *   Supporto per frequenza giornaliera.
    *   Logica intelligente per "Giorni Alterni" (Turno A / Turno B) basata su epoca fissa.
*   **Storico e Statistiche**: 
    *   **Calendario Mensile**: Vista completa del mese con navigazione.
    *   **Indicatori di Aderenza**: Pallini colorati sul calendario (Verde=100%, Giallo=Parziale, Rosso=Saltato).
    *   Logica intelligente: distingue tra medicinali "Saltati" (ieri) e "Da prendere" (oggi).
*   **Gestione Scorte & Lista Spesa üõí**:
    *   Tracciamento automatico della quantit√† residua.
    *   **Scorta Condivisa ü§ù**: Sincronizzazione automatica della quantit√† per medicinali usati in comune (es. stessa boccetta/scatola per entrambi).
    *   Badge di avviso quando le scorte sono in esaurimento o finite.
    *   **Lista Spesa Automatica**: Un click per generare la lista dei farmaci mancanti e inviarla via WhatsApp al partner ("Amore, serve comprare...").
*   **Sospensione Terapia ‚è∏Ô∏è**:
    *   Possibilit√† di **Archiviare** i farmaci temporaneamente (es. fine ciclo antibiotico o integratore).
    *   Rimangono salvati nelle impostazioni ma non appaiono nella lista giornaliera.
*   **Dark Mode Automatica üåô**:
    *   Si attiva automaticamente in base alle impostazioni del sistema operativo.
    *   Colori ottimizzati per l'uso notturno e per ridurre l'affaticamento visivo.
*   **UX & Gamification**:
    *   **Celebrazione Obiettivi**: Banner gratificante con animazione coriandoli (Confetti) al raggiungimento del 100% giornaliero.
    *   Feedback visivi animati (pop & flash) al completamento.
    *   Design chiaro con "Accent Bars" colorate per i compiti da svolgere.
    *   Ordinamento alfabetico o cronologico.
*   **Gestione Inventario**: 
    *   Aggiunta, modifica ed eliminazione farmaci con icone personalizzate (Pillole, Gocce, Bustine).
    *   **Raggruppamento Intelligente üìÇ**: I farmaci con lo stesso nome (es. presi mattina e sera) vengono raggruppati visivamente nelle Impostazioni per mantenere la lista ordinata e compatta.
*   **Funzionalit√† PWA**:
    *   Installabile su Home Screen (iOS/Android).
    *   Funziona come app nativa (niente barre del browser).
    *   **App Shortcuts**: Tieni premuta l'icona per saltare direttamente al profilo di Paolo o Barbara.
*   **Social**: Invio rapido promemoria via WhatsApp.

## üõ†Ô∏è Stack Tecnologico

*   **Frontend**: React 19, TypeScript
*   **Stile**: Tailwind CSS
*   **Icone**: Lucide React
*   **Gestione Date**: date-fns
*   **Backend/Database**: Supabase
*   **Hosting**: Google Cloud Run (Container Docker)

## üöÄ Installazione e Sviluppo Locale

1.  **Clona il repository**:
    ```bash
    git clone https://github.com/tuo-user/medicoppia.git
    cd medicoppia
    ```

2.  **Installa le dipendenze** (se usi un ambiente Node locale):
    ```bash
    npm install
    ```

3.  **Avvia l'app**:
    ```bash
    npm start
    ```

## üóÑÔ∏è Configurazione Database (Supabase)

L'applicazione richiede le seguenti tabelle su Supabase. Esegui questo script nell'SQL Editor della tua dashboard Supabase:

```sql
-- Tabella Farmaci
create table medications (
  id text primary key,
  user_id text not null,
  name text not null,
  dosage text,
  timing text,
  frequency text, -- 'daily', 'alternate_days', 'alternate_days_odd'
  notes text,
  icon text,      -- 'pill', 'drop', 'clock', 'sachet'
  stock_quantity numeric, -- NUOVO: Quantit√† residua
  stock_threshold numeric, -- NUOVO: Soglia avviso
  is_archived boolean default false, -- NUOVO: Stato archiviazione
  shared_id text, -- NUOVO: ID condivisione scorta
  created_at timestamptz default now()
);

-- Tabella Storico (Logs)
create table logs (
  id bigint generated by default as identity primary key,
  date text not null, -- Formato YYYY-MM-DD
  medication_id text not null references medications(id) on delete cascade,
  taken boolean default true,
  created_at timestamptz default now()
);

-- Abilita Realtime
alter publication supabase_realtime add table logs;
alter publication supabase_realtime add table medications;

-- Policy di Sicurezza (Semplificata per uso personale)
alter table medications enable row level security;
alter table logs enable row level security;
create policy "Accesso Totale" on medications for all using (true);
create policy "Accesso Totale" on logs for all using (true);
```

**‚ö†Ô∏è Aggiornamento Versione 1.17.0**:
Se hai gi√† il database creato, esegui questi comandi per aggiungere le colonne mancanti:
```sql
alter table medications add column shared_id text;
-- Se non hai aggiunto quelle precedenti:
alter table medications add column is_archived boolean default false;
alter table medications add column stock_quantity numeric;
alter table medications add column stock_threshold numeric;
```

Le credenziali API sono configurate in `constants.tsx`. **Nota**: In un ambiente di produzione pubblico, utilizzare variabili d'ambiente (`.env`).

## üê≥ Deploy con Docker (Cloud Run)

Il progetto include un `Dockerfile` ottimizzato e una configurazione `nginx.conf`.

1.  **Build**:
    ```bash
    docker build -t medicoppia .
    ```

2.  **Run**:
    ```bash
    docker run -p 8080:8080 medicoppia
    ```

## üì± Aggiungere alla Home (iOS/Android)

1.  Aprire il link dell'app in Safari (iOS) o Chrome (Android).
2.  Toccare il pulsante "Condividi" (iOS) o il menu tre puntini (Android).
3.  Selezionare **"Aggiungi alla schermata Home"**.

L'app apparir√† con la sua icona e supporter√† le azioni rapide (Long Press).